<div class="row g-4">

	<!-- Upload Document Card -->
	<div class="col-md-6">
		<div class="card shadow-sm p-4 h-100">
			<h5 class="card-title mb-4">Upload Document</h5>
			<form [formGroup]="uploadForm" (ngSubmit)="uploadDoc()" class="row g-4">

				<!-- Document Name -->
				<div class="col-12">
					<label class="form-label">Document Name</label>
					<input type="text" class="form-control" formControlName="name" required />
				</div>

				<!-- Description -->
				<div class="col-12">
					<label class="form-label">Description</label>
					<textarea class="form-control" formControlName="description" rows="3"></textarea>
				</div>

				<!-- File Input -->
				<div class="col-12">
					<label class="form-label">Select File </label>
					<input type="file" class="form-control" (change)="onFileChange($event)"
						accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx" />
					<div *ngIf="selectedFile" class="form-text mt-1">Selected: {{ selectedFile.name }}</div>
					<small class="text-muted">(only pdf, doc and docx are
						allowed)</small>
				</div>

				<!-- Upload Button -->
				<div class="col-12">
					<button type="submit" class="btn btn-primary w-100"
						[disabled]="uploading() || !uploadForm.valid || !selectedFile">
						{{ uploading() ? 'Uploading...' : 'Upload' }}
					</button>
				</div>

			</form>
		</div>
	</div>

	<!-- Uploaded Documents Card -->
	<div class="col-md-6">
		<div class="card shadow-sm p-4 h-100">
			<h5 class="card-title mb-3">Uploaded Documents</h5>

			<!-- Search Input -->
			<div class="mb-4">
				<label class="form-label">Search by Name</label>
				<input type="text" class="form-control" [value]="search()" (input)="onSearchChange($event)" />
			</div>

			<!-- Document Table -->
			<div class="table-responsive">
				<table class="table table-bordered align-middle mb-0">
					<thead class="table-light">
						<tr>
							<th>#</th>
							<th>Name</th>
							<th>Date Added</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let doc of filteredDocs">
							<td>{{ doc.serial_no }}</td>
							<td>{{ doc.name }}</td>
							<td>{{ formatDate(doc.dateAdded) }}</td>
							<td class="d-flex gap-2">

								<!-- Index Button with loader -->
								<button class="btn btn-sm btn-outline-success"
									[disabled]="doc.isIndexed || indexingDocId() === doc.id"
									[ngClass]="{ 'opacity-50': doc.isIndexed }"
									(click)="!doc.isIndexed && indexDoc(doc.id)">
									{{ doc.isIndexed ? 'Indexed' : (indexingDocId() === doc.id ? '' : 'Index') }}
									<span *ngIf="indexingDocId() === doc.id" class="spinner-border spinner-border-sm"
										role="status" aria-hidden="true"></span>
								</button>

								<!-- Delete Button -->
								<button class="btn btn-sm btn-outline-danger" (click)="delete(doc.id)">
									Delete
								</button>
							</td>
						</tr>
					</tbody>
				</table>

				<!-- Pagination -->
				<nav *ngIf="totalDocs() > pageSize" aria-label="Page navigation">
					<ul class="pagination justify-content-center mt-3">
						<li class="page-item" [class.disabled]="currentPage() === 1">
							<button class="page-link" (click)="changePage(currentPage() - 1)"
								[disabled]="currentPage() === 1">
								Previous
							</button>
						</li>

						<li class="page-item disabled">
							<span class="page-link">
								Page {{ currentPage() }} of {{ totalPages }}
							</span>
						</li>

						<li class="page-item" [class.disabled]="currentPage() * pageSize >= totalDocs()">
							<button class="page-link" (click)="changePage(currentPage() + 1)"
								[disabled]="currentPage() * pageSize >= totalDocs()">
								Next
							</button>
						</li>
					</ul>
				</nav>
			</div>

			<!-- No Documents Found -->
			<div *ngIf="!filteredDocs.length" class="text-center text-muted mt-4">
				No matching documents found.
			</div>
		</div>
	</div>

</div>

<!-- Bootstrap Toast -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
	<div id="indexToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive"
		aria-atomic="true">
		<div class="d-flex">
			<div class="toast-body">
				Document indexed successfully.
			</div>
			<button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
				aria-label="Close"></button>
		</div>
	</div>
</div>