<div class="mat-chat-layout">
	<mat-card class="mat-chat-left">
		<mat-form-field appearance="outline" class="w-100 mb-3">
			<mat-label>Search Documents</mat-label>
			<input matInput [(ngModel)]="searchTerm" (input)="searchDocuments()"
				placeholder="Search indexed documents..." />
		</mat-form-field>
		<div class="mb-2 mat-body-strong">Results</div>
		<mat-list>
			<mat-list-item *ngFor="let doc of visibleDocs" class="mat-list-item-row">
				<div class="flex-grow-1">
					<div matLine class="fw-bold">{{ doc.name }}</div>
					<div matLine class="text-muted small">{{ doc.filename }}</div>
				</div>
				<mat-checkbox [checked]="selectedDocIds.includes(doc.id)"
					(change)="toggleSelect(doc.id, $event.checked)" aria-label="Select document"></mat-checkbox>
				<button mat-icon-button color="primary" (click)="togglePin(doc)" [attr.aria-pressed]="isPinned(doc.id)">
					<mat-icon>{{ isPinned(doc.id) ? 'push_pin' : 'push_pin' }}</mat-icon>
				</button>
			</mat-list-item>
		</mat-list>
	</mat-card>

	<mat-card class="mat-chat-right d-flex flex-column">
		<div class="chat-messages flex-grow-1">
			<div *ngFor="let msg of messages" class="mb-2">
				<span [ngClass]="getMessageClass(msg.role)">
					<b>{{ msg.role }}:</b> {{ msg.content }}
				</span>
			</div>
			<div *ngIf="loading" class="text-muted">Assistant is typing...</div>
		</div>
		<form class="chat-input-row" (ngSubmit)="sendMessage()">
			<mat-form-field appearance="outline" class="flex-grow-1 m-0">
				<input matInput [(ngModel)]="query" name="chatQuery" placeholder="Type your message..."
					[disabled]="loading" />
			</mat-form-field>
			<button mat-raised-button color="primary" [disabled]="loading || !query.trim()" type="submit">Send</button>
		</form>
	</mat-card>
</div>